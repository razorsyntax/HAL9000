/*var math=require('mathjs');*/var NeuralNetwork=function(a){this.name=a||'NN',this.layers={inputLayer:{},hiddenLayer:[],outputLayer:[]},this.targets=[];};NeuralNetwork.prototype.createLayer=function(){var c=arguments[0];var b=arguments[1];typeof c!=='number'&&(b=arguments[0],c=1);try{c=b.type==='output'?1:c;}catch(e){alert('Please provide an attribute type when creating layers: output or hidden');return false;}for(let a=0;a<c;a++)switch(b.type){case'hidden':var d;var e=this.layers.hiddenLayer.length;d=e<1?'A':utilities.toLetters(e+1);if(b.neurons.length>0)for(let a=0;a<b.neurons.length;a++)b.neurons[a].id=d+(a+1).toString();this.layers.hiddenLayer.push({name:b.name||'',layerID:d,type:b.type,neurons:b.neurons});break;case'output':for(let a=0;a<b.neurons.length;a++)b.neurons[a].id='Output_'+(a+1);this.layers.outputLayer={type:b.type,neurons:b.neurons};return;default:alert("Please specify layer type: 'output' or 'hidden'");return!1;}},NeuralNetwork.prototype.setTarget=function(a){this.targets=a;},NeuralNetwork.prototype.init=function(f){var b=this.layers.hiddenLayer;var e=this.layers.outputLayer;var g=this.layers.inputLayer;var c=[];g.inputs=f;for(let a=0;a<b.length;a++)for(let d=0;d<b[a].neurons.length;d++)c=randomValues(f),b[a].neurons[d].wb={w:c,b:NeuralMathLib.randomGauss()};var h=b.length;var i=b[h-1].neurons.length;for(let a=0;a<e.neurons.length;a++)c=randomValues(i),e.neurons[a].wb={w:c,b:NeuralMathLib.randomGauss()};},NeuralNetwork.prototype.errors=function(a,b,c){this.globalError=a,this.globalFinal=b,this.predictionArray=c;};var Train=function(b,f,C,v,q){var s=[];var t=[];typeof v!=='number'&&(v=1),(q!==!0||q!==!1)&&(q=!0);for(let u=0;u<v;u++){var g=[];var l=[];var D=[];for(let a=0;a<b.layers.hiddenLayer.length;a++){var H=b.layers.hiddenLayer[a].neurons;var p=NeuralMathLib.activatedLayer(H,f,'hidden');l.push(p.activated),D.push(p);}var j=l[l.length-1];var A=b.layers.outputLayer.neurons;var F=NeuralMathLib.activatedLayer(A,j,'output');g=F.activated;var E=LossFunction(g,b.targets);var r=E.reduce(function(a,b,c,d){return a+b;});var e=NeuralMathLib.FinalOutputWeightCalcs(g,j,C,b);var J=e.outputWBs;var K=e.finalDeltaArr;var b=e.NN;var x=e.newOutputWeightArr;var y=e.errorOutput;var B=e.sig;var k=[];for(let a=0;a<b.layers.outputLayer.neurons.length;a++)k.push(utilities.returnArray(b.layers.outputLayer.neurons[a].wb.w));for(let a=0;a<x._data.length;a++)b.layers.outputLayer.neurons[a].wb.w=x._data[a];var G=utilities.returnArray(b.layers.hiddenLayer);var i=G.reverse();for(let d=0;d<i.length;d++){q&&(t.push(r),s.push(g._data),b.errors(t,r,s));var m=[];var h=[];for(let a=0;a<y._data.length;a++){for(let c=0;c<k[a].length;c++)m.push(y._data[a]*B._data[a]*k[a][c]);h.push(math.matrix(m)),m=[];}var o=math.zeros(h[0]._data.length);for(let a=0;a<h.length;a++)o=math.add(o,h[a]);var I=Derivatives.dSig(p.activated._data);f=d===0?f:j._data;var z=[];for(let a=0;a<f.length;a++)z.push(o._data[a]*I._data[a]*f[a]);var n=[];var w=[];for(let a=0;a<f.length;a++){for(let c=0;c<i[d].neurons.length;c++)n.push(i[d].neurons[a].wb.w[c]-C*z[a]);w.push(n),n=[];}b.layers.hiddenLayer[d]=UpdateWeights(math.matrix(w),i[d]);}}return b;};var StopLearning=function(){return!1;};var Neuron=function(a){this.activation=a.activation||'logsig',this.id='';};Neuron.prototype.update=function(a){this.obj=a||this.obj;};var NeuronArray=function(a,b){var c=[];a=a||0,b=b||'logsig';for(var d=0;d<a;d++)c.push(new Neuron({activation:b}));return c;};var utilities={nextLetter:function(c){var a=utilities.toNumbers(c);var b=a+1;return utilities.toLetters(b);},lastLetter:function(d){var a=utilities.toNumbers(d);var b=a-1;var c=utilities.toLetters(b);return c;},toLetters:function(d){'use strict';var b=d%26;var a=d/26|0;var c=b?String.fromCharCode(64+b):(a--,'Z');return a?utilities.toLetters(a)+c:c;},toNumbers:function(d){'use strict';var b;var c=0;try{b=d.length;}catch(err){len=0;}var a=b;while((a-=1)>-1)c+=(d.charCodeAt(a)-64)*Math.pow(26,b-1-a);return c;},returnArray:function(c){var b=[];for(let a=0;a<c.length;a++)b.push(c[a]);return b;}};var NeuralMathLib={activations:function(e,a){var b=a;switch(e.activation){case'logsig':return 1/(1+Math.exp(-b));case'tanh':var c=Math.exp(b);var d=Math.exp(-b);return(c-d)/(c+d);case'linear':return a;case'satlin':if(a<0)return 0;if(a>=0&&a<=1)return a;if(a>1)return 1;case'arctan':return Math.atan(b);case'gaussian':return Math.exp(-Math.pow(b,2));}},activatedLayer:function(b,j,i){'use strict';var g,c,e,h,a;var f=[];var d=[];for(let a=0;a<b.length;a++){g=b[a].id;switch(i){case'hidden':c=b.filter(function(a){return a.id===g;});break;case'output':c=b.filter(function(b){return b.id==='Output_'+(a+1);});}e=NeuralMathLib.summation(b[a].wb,j),f.push(e),h=NeuralMathLib.activations(c[0],e),d.push(h);}return{activated:math.matrix(d),sums:math.matrix(f)};},FinalOutputWeightCalcs:function(l,n,m,i){var b=[];var f=[];var g=utilities.returnArray(i.layers.outputLayer.neurons);for(let a=0;a<g.length;a++)b.push(g[a].wb.w);var j=Derivatives.dSig(l._data);var c=math.subtract(l,math.matrix(i.targets));var h=[];for(let a=0;a<c._data.length;a++)h.push(c._data[a]*j._data[a]);for(let a=0;a<c._data.length;a++)f.push(h[a]*n._data[a]);var e=[];var k=[];for(let a=0;a<b.length;a++){for(let d=0;d<b[a].length;d++)e.push(b[a][d]-m*f[a]);k.push(e),e=[];}return{outputWBs:math.matrix(b),finalDeltaArr:f,NN:i,newOutputWeightArr:math.matrix(k),errorOutput:c,sig:j};},summation:function(a,g){var b=a.w;var c=a.b;var d=math.matrix(g);var e=math.matrix(b);var f=math.multiply(d,e);return math.add(f,c);},randomGauss:function(){var c,d,a;do c=2*Math.random()-1,d=2*Math.random()-1,a=c*c+d*d;while(a>=1||a==0);var e=Math.sqrt(-2*Math.log(a)/a);var b=Math.abs(c*e);return b>1&&(b=1/b),b;},eTotal:function(c,d){var a=[];a.push(math.multiply(d,math.matrix(c)));var b=function(a,b){return a+b;};return total=a[0]._data.reduce(b),total;}};var Derivatives={dSig:function(b){var c=[];let a=0;while(a<b.length)c.push(b[a]*(1-b[a])),a++;return math.matrix(c);}};var LossFunction=function(e,a){a=math.matrix(a);var b=math.subtract(a,e);var c=math.square(b);var d=math.multiply(c,0.5);return d._data;};var MeanSquaredErr=function(a){var b=a._data.reduce(function(a,b,c,d){return a+b*0.5;});return b/a.length*100;};var UpdateWeights=function(c,d){var b=d;for(let a=0;a<b.neurons.length;a++)b.neurons[a].wb.w=c._data[a];return b;};var randomValues=function(a){var b=[],d;d=typeof a==='number'?a:a.length;for(let c=0;c<d;c++)b.push(NeuralMathLib.randomGauss());return b;};/*module.exports={NeuralNetwork:NeuralNetwork,StopLearning:StopLearning,NeuronArray:NeuronArray,Train:Train};*/
